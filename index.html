<!DOCTYPE html>
<html lang="pt_BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ideal Focus</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Lexend+Peta:wght@100..900&family=Quicksand:wght@300..700&display=swap"
        rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Lexend+Peta:wght@100..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Quicksand:wght@300..700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="estilos/styleindex.css">
    <link rel="shortcut icon" href="imagens/favicon.ico" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous"></script>
</head>

<body>
    <header>
        <h1>IdFocus Cadastro</h1>
    </header>
    <div class="modal-overlay active">
        <div id="principal" class="modal-overlay active">
            <h4>Idfocus cadastro</h4>

            <form id="formCadastro">


                <div id="boxName" class="input-group">
                    <span id="ico_user">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
                            fill="#Fff">
                            <path
                                d="M480-480q-66 0-113-47t-47-113q0-66 47-113t113-47q66 0 113 47t47 113q0 66-47 113t-113 47ZM160-160v-112q0-34 17.5-62.5T224-378q62-31 126-46.5T480-440q66 0 130 15.5T736-378q29 15 46.5 43.5T800-272v112H160Zm80-80h480v-32q0-11-5.5-20T700-306q-54-27-109-40.5T480-360q-56 0-111 13.5T260-306q-9 5-14.5 14t-5.5 20v32Zm240-320q33 0 56.5-23.5T560-640q0-33-23.5-56.5T480-720q-33 0-56.5 23.5T400-640q0 33 23.5 56.5T480-560Zm0-80Zm0 400Z" />
                        </svg>
                    </span>
                    <input type="text" id="iname" placeholder="Nome" class="inputsForm" autocomplete="name" required>
                </div>


                <div id="boxEmail" class="input-group">
                    <span id="ico_user">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
                            fill="#e3e3e3">
                            <path
                                d="M160-160q-33 0-56.5-23.5T80-240v-480q0-33 23.5-56.5T160-800h640q33 0 56.5 23.5T880-720v480q0 33-23.5 56.5T800-160H160Zm320-280L160-640v400h640v-400L480-440Zm0-80 320-200H160l320 200ZM160-640v-80 480-400Z" />
                        </svg>
                    </span>
                    <input type="text" id="iuser" placeholder="Email" class="inputsForm" autocomplete="email" required>
                </div>

                <div id="boxPass" class="input-group">
                    <span id="ico_pass">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
                            fill="#Fff">
                            <path
                                d="M280-400q-33 0-56.5-23.5T200-480q0-33 23.5-56.5T280-560q33 0 56.5 23.5T360-480q0 33-23.5 56.5T280-400Zm0 160q-100 0-170-70T40-480q0-100 70-170t170-70q67 0 121.5 33t86.5 87h352l120 120-180 180-80-60-80 60-85-60h-47q-32 54-86.5 87T280-240Zm0-80q56 0 98.5-34t56.5-86h125l58 41 82-61 71 55 75-75-40-40H435q-14-52-56.5-86T280-640q-66 0-113 47t-47 113q0 66 47 113t113 47Z" />
                        </svg>
                    </span>
                    <input type="password" id="ipass" placeholder="Senha" class="inputsForm" autocomplete="new-password"
                        required>
                </div>

                <button type="submit" id="go" ">
                    <span class=" spinner-border spinner-border-sm" aria-hidden="true" id="load"></span>
                    Cadastrar</button>
            </form>
            <span id="jaTem">Já tem uma conta? <a href="login.html" id="a_jaTem">Logar</a></span>
        </div>
    </div>
    
    
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header bg-secondary-subtle text-secondary-emphasis">
                <img src="imagens/idf-favicon.png" class="rounded me-2">
                <strong class="me-auto">IdFocus</strong>
                <small>1s atrás</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body bg-success-subtle text-success-emphasis">
                Registro realizado com sucesso! redirecionando para o Login.
            </div>
        </div>
    </div>
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="liveToast2" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header bg-secondary-subtle text-secondary-emphasis">
                <img src="imagens/idf-favicon.png" class="rounded me-2">
                <strong class="me-auto">IdFocus</strong>
                <small>1s atrás</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body text-danger-emphasis">
                Houve um erro. Tente novamente mais tarde.
            </div>
        </div>
    </div>
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="liveToast3" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header bg-secondary-subtle text-secondary-emphasis">
                <img src="imagens/idf-favicon.png" class="rounded me-2">
                <strong class="me-auto">IdFocus</strong>
                <small>1s atrás</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body text-danger-emphasis">
                Erro! Email já cadastrado.
            </div>
        </div>
    </div>
</body>

<script>
    let load = document.getElementById("load");
    load.style.display = "none";

    document.getElementById("formCadastro").addEventListener("submit", async (e) => {
        e.preventDefault();

        const formData = {
            email: document.getElementById('iuser').value,
            name: document.getElementById('iname').value,
            password: document.getElementById('ipass').value
        };

        load.style.display = "inline-block";

        const response = await fetch("https://backend-idf.vercel.app/register", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(formData)
        });

        const result = await response.json();
        console.log(result);

        if (result.user) {
            load.style.display = "none";
            new bootstrap.Toast(document.getElementById('liveToast')).show();

            setTimeout(() => {
                window.location.href = "./login.html";
            }, 3000);

        } else {
            load.style.display = "none";
            if(result.error == "Email já cadastrado."){
                new bootstrap.Toast(document.getElementById('liveToast3')).show();
            }else{
                new bootstrap.Toast(document.getElementById('liveToast2')).show();
            }
        }
    });
</script>

</html>